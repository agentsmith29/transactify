{% extends "./sidebar/sidebar.html" %}
{% load static %}
{% load custom_filters %}

{% block header %}
<title>Manage Products</title>
<link rel="stylesheet" href="{% static 'assets/dist/css/badges.css' %}">
<style>
.table-responsive {
    max-height: auto;
    overflow-y: auto; /* Scrolls only the table content */
}
</style>
{% endblock %}




{% block content %}
<div class="container-fluid mt-5">
    <h1 class="mb-4">System Logs</h1>

    <!-- Filter and Search Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <label for="logLevelFilter">Filter by Log Level:</label>
            <select id="logLevelFilter" class="form-control">
                <option value="">All</option>
                <option value="Info">Info</option>
                <option value="Debug">Debug</option>
                <option value="Success">Success</option>
                <option value="Danger">Danger</option>
                <option value="Warning">Warning</option>
            </select>
        </div>

        <div class="col-md-6">
            <label for="searchLogs">Search Logs:</label>
            <input id="searchLogs" type="text" class="form-control" placeholder="Search logs by message or module">
        </div>
    </div>

    <!-- Clear Logs Button -->
    <div class="row mb-4">
        <div class="col-12 text-right">
            <button id="clearLogsButton" class="btn btn-danger">Clear Logs</button>
        </div>
    </div>

    <!-- Logs Table -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered w-100">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Timestamp</th>
                    <th scope="col">Log Level</th>
                    <th scope="col">Module</th>
                    <th scope="col">Message</th>
                </tr>
            </thead>
            <tbody id="logsTableBody">
                {% for log in logs %}
                <tr class="log-entry" data-loglevel="{{ log.loglevel }}" data-module="{{ log.module }}">
                    <td>{{ log.timestamp }}</td>
                    <td>
                        {% if log.loglevel == "INFO" %}<span class="badge badge-pill badge-primary">Info</span>{% endif %}
                        {% if log.loglevel == "DEBUG" %}<span class="badge badge-pill badge-secondary">Debug</span>{% endif %}
                        {% if log.loglevel == "SUCCESS" %}<span class="badge badge-pill badge-success">Success</span>{% endif %}
                        {% if log.loglevel == "ERROR" %}<span class="badge badge-pill badge-danger">Error</span>{% endif %}
                        {% if log.loglevel == "WARNING" %}<span class="badge badge-pill badge-warning">Warning</span>{% endif %}
                    </td>
                    <td>{{ log.module }}</td>
                    <td>{{ log.message }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No logs available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <div class="d-flex justify-content-center mt-4">
        <nav class="pagination">
            <ul class="pagination pagination-sm">
                <!-- Previous Page -->
                {% if logs.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ logs.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% endif %}
    
                <!-- Page Numbers -->
                {% for num in logs.paginator.page_range %}
                <li class="page-item {% if logs.number == num %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
                {% endfor %}
    
                <!-- Next Page -->
                {% if logs.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ logs.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    



</div>
{% endblock %}


{% block scripts %}
<script src="{% static 'assets/js/log-view-helper.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        window.log = new LogViewHelper('logs', "{% url 'logs' %}");
    });
</script>
{% endblock %}

